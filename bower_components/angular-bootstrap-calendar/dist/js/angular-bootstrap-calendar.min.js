"use strict";angular.module("mwl.calendar",["ui.bootstrap"]),angular.module("mwl.calendar").constant("moment",window.moment),angular.module("mwl.calendar").service("calendarHelper",["$filter","moment",function(e,t){function n(){return 1===t().startOf("week").day()}function a(e){return angular.isDefined(e)?e:n()}var r=this;this.getMonthNames=function(t){for(var n=t?"MMM":"MMMM",a=[],r=0;11>=r;r++)a.push(e("date")(new Date(2014,r),n));return a},this.getWeekDayNames=function(t,n){for(var r=t?"EEE":"EEEE",i=[],l=a(n)?22:21,d=0;6>=d;d++)i.push(e("date")(new Date(2014,8,l+d),r));return i},this.eventIsInPeriod=function(e,n,a,r){return t(e).isAfter(t(a))&&t(e).isBefore(t(r))||t(n).isAfter(t(a))&&t(n).isBefore(t(r))||t(e).isBefore(t(a))&&t(n).isAfter(t(r))||t(e).isSame(t(a))||t(n).isSame(t(r))},this.getYearView=function(e,n){for(var a=[],i=r.getMonthNames(),l=0;3>l;l++){for(var d=[],o=0;4>o;o++){var c=12-i.length,s=new Date(t(n).format("YYYY"),c,1),u=t(s).add(1,"month").subtract(1,"second").toDate();d.push({label:i.shift(),monthIndex:c,isToday:t(s).startOf("month").isSame(t().startOf("month")),events:e.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,s,u)})})}a.push(d)}return a},this.getMonthView=function(e,n,i){function l(){var e=o.day()-d;return 0>e&&(e=6),e}for(var d=a(i)?1:0,o=t(n).startOf("month"),c=t(n).endOf("month").date(),s=[],u=new Array(7),f=e.map(function(e,t){return e.$id=t,e}),v=1;c>=v;v++){if(1==v)for(var m=l(o),y=o.clone();m>0;)m--,y=y.subtract(1,"day"),u[m]={label:y.date(),date:y.clone(),inMonth:!1,events:[]};if(u[l(o)]={label:o.date(),inMonth:!0,isToday:t().startOf("day").isSame(o),date:o.clone(),events:f.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,o.clone().startOf("day"),o.clone().endOf("day"))})},v==c)for(var m=l(o),h=o.clone();6>m;)m++,h=h.add(1,"day"),u[m]={label:h.date(),date:h.clone(),inMonth:!1,events:[]};(6===l(o)||v==c)&&(s.push(u),u=new Array(7)),o=o.add(1,"day")}return s},this.getWeekView=function(n,i,l){for(var d,o,c=a(l)?1:0,s=new Array(7),u=r.getWeekDayNames(!1,l),f=i.getDay(),v=f;v>=0;v--){var m=t(i).subtract(f-v,"days").add(c,"day").toDate();s[v]={weekDay:u[v],day:e("date")(m,"d"),date:e("date")(m,"d MMM"),isToday:t(m).startOf("day").isSame(t().startOf("day"))},0==v?d=m:6==v&&(o=m)}for(var v=f+1;7>v;v++){var m=t(i).add(v-f,"days").add(c,"day").toDate();s[v]={weekDay:u[v],day:e("date")(m,"d"),date:e("date")(m,"d MMM"),isToday:t(m).startOf("day").isSame(t().startOf("day"))},0==v?d=m:6==v&&(o=m)}o=t(o).endOf("day").toDate(),d=t(d).startOf("day").toDate();var y=n.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,d,o)}).map(function(e){var n=t(e.ends_at).startOf("day").diff(t(e.starts_at).startOf("day"),"days")+1;n>=7&&(n=7,t(e.ends_at).startOf("day").diff(t(o).startOf("day"),"days")<0&&(n+=t(e.ends_at).startOf("day").diff(t(o).startOf("day"),"days")+c));var a=t(e.starts_at).startOf("day").diff(t(d).startOf("day"),"days");return 0>a&&(a=0),a>6&&(a=6),n-a>0&&(n-=a),e.daySpan=n,e.dayOffset=a,e});return{columns:s,events:y}},this.getDayView=function(e,n){var a=t(n).startOf("day").add(6,"hours"),i=t(n).startOf("day").add(22,"hours"),l=960,d=[];return e.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,t(n).startOf("day").toDate(),t(n).endOf("day").toDate())}).map(function(e){if(e.top=t(e.starts_at).isBefore(a)?0:t(e.starts_at).startOf("minute").diff(a.startOf("minute"),"minutes")-2,t(e.ends_at).isAfter(i))e.height=l-e.top;else{var n=e.starts_at;t(e.starts_at).isBefore(a)&&(n=a.toDate()),e.height=t(e.ends_at).diff(n,"minutes")}return e.top-e.height>l&&(e.height=0),e.left=0,e}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return d.forEach(function(n,a){var i=!0;n.forEach(function(t){(r.eventIsInPeriod(e.starts_at,e.ends_at,t.starts_at,t.ends_at)||r.eventIsInPeriod(t.starts_at,t.ends_at,e.starts_at,e.ends_at))&&(i=!1)}),i&&t&&(t=!1,e.left=150*a,d[a].push(e))}),t&&(e.left=150*d.length,d.push([e])),e})},this.toggleEventBreakdown=function(e,t,n){var a=[];if(e[t][n].events.length>0){var r=e[t][n].isOpened;e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})}),e[t][n].isOpened=!r,e[t].isOpened=!r,a=e[t][n].events}return{view:e,openEvents:a}}}]),angular.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,t,n){return e?e.length>=t&&e.length/20>n/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").directive("mwlCalendarYear",["$sce","$timeout","calendarHelper","moment",function(e,t,n,a){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen"},link:function(r,i,l,d){function o(){r.view=n.getYearView(r.events,r.currentDay),r.autoOpen&&!c&&r.view.forEach(function(e,n){e.forEach(function(e,i){e.label==a(r.currentDay).format("MMMM")&&(r.monthClicked(n,i),t(function(){c=!1}))})})}var c=!1;r.$sce=e,d.titleFunctions.year=function(e){return a(e).format("YYYY")},r.$watch("currentDay",o),r.$watch("events",o,!0),r.monthClicked=function(e,t){var a=n.toggleEventBreakdown(r.view,e,t);r.view=a.view,r.openEvents=a.openEvents},r.drillDown=function(e){d.changeView("month",a(r.currentDay).clone().month(e).toDate())}}}}]),angular.module("mwl.calendar").directive("mwlCalendarWeek",["moment","calendarHelper",function(e,t){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",useIsoWeek:"=calendarUseIsoWeek"},link:function(n,a,r,i){function l(){n.view=t.getWeekView(n.events,n.currentDay,n.useIsoWeek)}i.titleFunctions.week=function(t){return"Week "+e(t).week()+" of "+e(t).format("YYYY")},n.drillDown=function(t){i.changeView("day",e(n.currentDay).clone().date(t).toDate())},n.$watch("currentDay",l),n.$watch("events",l,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendarMonth",["$sce","$timeout","calendarHelper",function(e,t,n){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek"},link:function(a,r,i,l){function d(){a.view=n.getMonthView(a.events,a.currentDay,a.useIsoWeek),a.autoOpen&&!o&&a.view.forEach(function(e,n){e.forEach(function(e,r){e.inMonth&&moment(a.currentDay).startOf("day").isSame(e.date.startOf("day"))&&(a.dayClicked(n,r),t(function(){o=!1}))})})}var o=!1;a.$sce=e,l.titleFunctions.month=function(e){return moment(e).format("MMMM YYYY")},a.$watch("currentDay",d),a.$watch("events",d,!0),a.weekDays=n.getWeekDayNames(!1,a.useIsoWeek),a.dayClicked=function(e,t){var r=n.toggleEventBreakdown(a.view,e,t);a.view=r.view,a.openEvents=r.openEvents},a.drillDown=function(e){l.changeView("day",moment(a.currentDay).clone().date(e).toDate())},a.highlightEvent=function(e,t){a.view=a.view.map(function(n){return n.isOpened=!1,n.map(function(n){if(delete n.highlightClass,n.isOpened=!1,t){var a=n.events.filter(function(t){return t.$id==e.$id}).length>0;a&&(n.highlightClass="day-highlight dh-event-"+e.type)}return n})})}}}}]),angular.module("mwl.calendar").directive("mwlCalendarDay",["calendarHelper",function(e){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick"},link:function(t,n,a,r){function i(){t.view=e.getDayView(t.events,t.currentDay)}r.titleFunctions.day=function(e){return moment(e).format("dddd DD MMMM, YYYY")},t.$watch("currentDay",i),t.$watch("events",i,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendar",["moment",function(e){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek"},controller:["$scope",function(t){var n=this;this.titleFunctions={},this.changeView=function(e,n){t.view=e,t.currentDay=n},t.control=t.control||{},t.control.prev=function(){t.currentDay=e(t.currentDay).subtract(1,t.view).toDate()},t.control.next=function(){t.currentDay=e(t.currentDay).add(1,t.view).toDate()},t.control.getTitle=function(){return n.titleFunctions[t.view]?n.titleFunctions[t.view](t.currentDay):""}}]}}]);
//# sourceMappingURL=angular-bootstrap-calendar.min.js.map