"use strict";angular.module("mwl.calendar",["ui.bootstrap"]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("templates/day.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell">Time</div><div class="span11 col-xs-11 cal-cell">Events</div></div><div class="cal-day-panel" style="height: 960px;"><div class="cal-day-panel-hour"><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>06:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>06:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>07:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>07:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>08:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>08:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>09:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>09:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>10:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>10:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>11:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>11:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>12:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>12:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>13:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>13:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>14:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>14:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>15:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>15:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>16:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>16:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>17:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>17:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>18:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>18:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>19:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>19:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>20:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>20:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>21:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>21:30</b></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight dh-event-{{ event.type }}" ng-repeat="event in view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="eventClick({$event: event})"><span>{{ event.title | truncateEventTitle:20:event.height }}</span></a></div></div></div>'),e.put("templates/main.html",'<div class="cal-context" style="width: 100%;"><mwl-calendar-year calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" calendar-edit-event-click="eventEditClick" calendar-delete-event-click="eventDeleteClick" calendar-edit-event-html="editEventHtml" calendar-delete-event-html="deleteEventHtml" calendar-auto-open="autoOpen" ng-if="view == \'year\'"></mwl-calendar-year><mwl-calendar-month calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" calendar-edit-event-click="eventEditClick" calendar-delete-event-click="eventDeleteClick" calendar-edit-event-html="editEventHtml" calendar-delete-event-html="deleteEventHtml" calendar-auto-open="autoOpen" calendar-use-iso-week="useIsoWeek" ng-if="view == \'month\'"></mwl-calendar-month><mwl-calendar-week calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" calendar-use-iso-week="useIsoWeek" ng-if="view == \'week\'"></mwl-calendar-week><mwl-calendar-day calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" ng-if="view == \'day\'"></mwl-calendar-day></div>'),e.put("templates/month.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in weekDays">{{ day }}</div></div><div class="cal-month-box"><div ng-repeat="week in view track by $index"><div class="cal-row-fluid cal-before-eventlist"><div class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-repeat="day in week track by $index" ng-click="dayClicked($parent.$index, $index)" ng-class="{pointer: day.events.length > 0}"><div class="cal-month-day" ng-class="{\'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': $index == 5 || $index == 6, \'cal-day-today\': day.isToday}"><span class="pull-right" data-cal-date="" ng-click="drillDown(day.label)">{{ day.label }}</span><div class="cal-day-tick" ng-show="day.isOpened"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="eventClick({$event: event})" ng-repeat="event in day.events track by $index" class="pull-left event event-{{ event.type }}" ng-mouseenter="highlightEvent(event, true)" ng-mouseleave="highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div></div></div></div><div class="cal-slide-box" collapse="!week.isOpened"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in openEvents track by $index"><span class="pull-left event event-{{ event.type }}"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="eventClick({$event: event})">{{ event.title }}</a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="$sce.trustAsHtml(editEventHtml)" ng-click="eventEditClick({$event: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="$sce.trustAsHtml(deleteEventHtml)" ng-click="eventDeleteClick({$event: event})"></a></li></ul></div></div></div></div>'),e.put("templates/week.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="column in view.columns track by $index" ng-class="{\'cal-day-weekend\': $index > 4, \'cal-day-today\': column.isToday}">{{ column.weekDay }}<br><small><span data-cal-date="" ng-click="drillDown(column.day)" class="pointer">{{ column.date }}</span></small></div></div><hr><div class="cal-row-fluid" ng-repeat="event in view.events track by $index"><div class="cal-cell{{ event.daySpan }} cal-offset{{ event.dayOffset }} day-highlight dh-event-{{ event.type }}" data-event-class=""><a href="javascript:;" ng-click="eventClick({$event: event})" class="cal-event-week">{{ event.title }}</a></div></div></div>'),e.put("templates/year.html",'<div class="cal-year-box"><div ng-repeat="year in view track by $index"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in year track by $index" ng-click="monthClicked($parent.$index, $index)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date="" ng-click="drillDown(month.monthIndex)">{{ month.label }}</span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.events.length > 0">{{ month.events.length }}</small><div class="cal-day-tick" ng-show="month.isOpened"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><div class="cal-slide-box" collapse="!year.isOpened"><span class="cal-slide-tick"></span><div class="cal-slide-content"><ul class="unstyled list-unstyled"><li ng-repeat="event in openEvents track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="eventClick({$event: event})">{{ event.title }}</a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="$sce.trustAsHtml(editEventHtml)" ng-click="eventEditClick({$event: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="$sce.trustAsHtml(deleteEventHtml)" ng-click="eventDeleteClick({$event: event})"></a></li></ul></div></div></div></div>')}]),angular.module("mwl.calendar").constant("moment",window.moment),angular.module("mwl.calendar").service("calendarHelper",["$filter","moment",function(e,a){function t(){return 1===a().startOf("week").day()}function n(e){return angular.isDefined(e)?e:t()}var l=this;this.getMonthNames=function(a){for(var t=a?"MMM":"MMMM",n=[],l=0;11>=l;l++)n.push(e("date")(new Date(2014,l),t));return n},this.getWeekDayNames=function(a,t){for(var l=a?"EEE":"EEEE",s=[],i=n(t)?22:21,d=0;6>=d;d++)s.push(e("date")(new Date(2014,8,i+d),l));return s},this.eventIsInPeriod=function(e,t,n,l){return a(e).isAfter(a(n))&&a(e).isBefore(a(l))||a(t).isAfter(a(n))&&a(t).isBefore(a(l))||a(e).isBefore(a(n))&&a(t).isAfter(a(l))||a(e).isSame(a(n))||a(t).isSame(a(l))},this.getYearView=function(e,t){for(var n=[],s=l.getMonthNames(),i=0;3>i;i++){for(var d=[],c=0;4>c;c++){var r=12-s.length,v=new Date(a(t).format("YYYY"),r,1),o=a(v).add(1,"month").subtract(1,"second").toDate();d.push({label:s.shift(),monthIndex:r,isToday:a(v).startOf("month").isSame(a().startOf("month")),events:e.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,v,o)})})}n.push(d)}return n},this.getMonthView=function(e,t,s){function i(){var e=c.day()-d;return 0>e&&(e=6),e}for(var d=n(s)?1:0,c=a(t).startOf("month"),r=a(t).endOf("month").date(),v=[],o=new Array(7),u=e.map(function(e,a){return e.$id=a,e}),p=1;r>=p;p++){if(1==p)for(var h=i(c),f=c.clone();h>0;)h--,f=f.subtract(1,"day"),o[h]={label:f.date(),date:f.clone(),inMonth:!1,events:[]};if(o[i(c)]={label:c.date(),inMonth:!0,isToday:a().startOf("day").isSame(c),date:c.clone(),events:u.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,c.clone().startOf("day"),c.clone().endOf("day"))})},p==r)for(var h=i(c),y=c.clone();6>h;)h++,y=y.add(1,"day"),o[h]={label:y.date(),date:y.clone(),inMonth:!1,events:[]};(6===i(c)||p==r)&&(v.push(o),o=new Array(7)),c=c.add(1,"day")}return v},this.getWeekView=function(t,s,i){for(var d,c,r=n(i)?1:0,v=new Array(7),o=l.getWeekDayNames(!1,i),u=s.getDay(),p=u;p>=0;p--){var h=a(s).subtract(u-p,"days").add(r,"day").toDate();v[p]={weekDay:o[p],day:e("date")(h,"d"),date:e("date")(h,"d MMM"),isToday:a(h).startOf("day").isSame(a().startOf("day"))},0==p?d=h:6==p&&(c=h)}for(var p=u+1;7>p;p++){var h=a(s).add(p-u,"days").add(r,"day").toDate();v[p]={weekDay:o[p],day:e("date")(h,"d"),date:e("date")(h,"d MMM"),isToday:a(h).startOf("day").isSame(a().startOf("day"))},0==p?d=h:6==p&&(c=h)}c=a(c).endOf("day").toDate(),d=a(d).startOf("day").toDate();var f=t.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,d,c)}).map(function(e){var t=a(e.ends_at).startOf("day").diff(a(e.starts_at).startOf("day"),"days")+1;t>=7&&(t=7,a(e.ends_at).startOf("day").diff(a(c).startOf("day"),"days")<0&&(t+=a(e.ends_at).startOf("day").diff(a(c).startOf("day"),"days")+r));var n=a(e.starts_at).startOf("day").diff(a(d).startOf("day"),"days");return 0>n&&(n=0),n>6&&(n=6),t-n>0&&(t-=n),e.daySpan=t,e.dayOffset=n,e});return{columns:v,events:f}},this.getDayView=function(e,t){var n=a(t).startOf("day").add(6,"hours"),s=a(t).startOf("day").add(22,"hours"),i=960,d=[];return e.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,a(t).startOf("day").toDate(),a(t).endOf("day").toDate())}).map(function(e){if(e.top=a(e.starts_at).isBefore(n)?0:a(e.starts_at).startOf("minute").diff(n.startOf("minute"),"minutes")-2,a(e.ends_at).isAfter(s))e.height=i-e.top;else{var t=e.starts_at;a(e.starts_at).isBefore(n)&&(t=n.toDate()),e.height=a(e.ends_at).diff(t,"minutes")}return e.top-e.height>i&&(e.height=0),e.left=0,e}).filter(function(e){return e.height>0}).map(function(e){var a=!0;return d.forEach(function(t,n){var s=!0;t.forEach(function(a){(l.eventIsInPeriod(e.starts_at,e.ends_at,a.starts_at,a.ends_at)||l.eventIsInPeriod(a.starts_at,a.ends_at,e.starts_at,e.ends_at))&&(s=!1)}),s&&a&&(a=!1,e.left=150*n,d[n].push(e))}),a&&(e.left=150*d.length,d.push([e])),e})},this.toggleEventBreakdown=function(e,a,t){var n=[];if(e[a][t].events.length>0){var l=e[a][t].isOpened;e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})}),e[a][t].isOpened=!l,e[a].isOpened=!l,n=e[a][t].events}return{view:e,openEvents:n}}}]),angular.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,a,t){return e?e.length>=a&&e.length/20>t/30?e.substr(0,a)+"...":e:""}}),angular.module("mwl.calendar").directive("mwlCalendarYear",["$sce","$timeout","calendarHelper","moment",function(e,a,t,n){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen"},link:function(l,s,i,d){function c(){l.view=t.getYearView(l.events,l.currentDay),l.autoOpen&&!r&&l.view.forEach(function(e,t){e.forEach(function(e,s){e.label==n(l.currentDay).format("MMMM")&&(l.monthClicked(t,s),a(function(){r=!1}))})})}var r=!1;l.$sce=e,d.titleFunctions.year=function(e){return n(e).format("YYYY")},l.$watch("currentDay",c),l.$watch("events",c,!0),l.monthClicked=function(e,a){var n=t.toggleEventBreakdown(l.view,e,a);l.view=n.view,l.openEvents=n.openEvents},l.drillDown=function(e){d.changeView("month",n(l.currentDay).clone().month(e).toDate())}}}}]),angular.module("mwl.calendar").directive("mwlCalendarWeek",["moment","calendarHelper",function(e,a){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",useIsoWeek:"=calendarUseIsoWeek"},link:function(t,n,l,s){function i(){t.view=a.getWeekView(t.events,t.currentDay,t.useIsoWeek)}s.titleFunctions.week=function(a){return"Week "+e(a).week()+" of "+e(a).format("YYYY")},t.drillDown=function(a){s.changeView("day",e(t.currentDay).clone().date(a).toDate())},t.$watch("currentDay",i),t.$watch("events",i,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendarMonth",["$sce","$timeout","calendarHelper",function(e,a,t){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek"},link:function(n,l,s,i){function d(){n.view=t.getMonthView(n.events,n.currentDay,n.useIsoWeek),n.autoOpen&&!c&&n.view.forEach(function(e,t){e.forEach(function(e,l){e.inMonth&&moment(n.currentDay).startOf("day").isSame(e.date.startOf("day"))&&(n.dayClicked(t,l),a(function(){c=!1}))})})}var c=!1;n.$sce=e,i.titleFunctions.month=function(e){return moment(e).format("MMMM YYYY")},n.$watch("currentDay",d),n.$watch("events",d,!0),n.weekDays=t.getWeekDayNames(!1,n.useIsoWeek),n.dayClicked=function(e,a){var l=t.toggleEventBreakdown(n.view,e,a);n.view=l.view,n.openEvents=l.openEvents},n.drillDown=function(e){i.changeView("day",moment(n.currentDay).clone().date(e).toDate())},n.highlightEvent=function(e,a){n.view=n.view.map(function(t){return t.isOpened=!1,t.map(function(t){if(delete t.highlightClass,t.isOpened=!1,a){var n=t.events.filter(function(a){return a.$id==e.$id}).length>0;n&&(t.highlightClass="day-highlight dh-event-"+e.type)}return t})})}}}}]),angular.module("mwl.calendar").directive("mwlCalendarDay",["calendarHelper",function(e){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick"},link:function(a,t,n,l){function s(){a.view=e.getDayView(a.events,a.currentDay)}l.titleFunctions.day=function(e){return moment(e).format("dddd DD MMMM, YYYY")},a.$watch("currentDay",s),a.$watch("events",s,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendar",["moment",function(e){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek"},controller:["$scope",function(a){var t=this;this.titleFunctions={},this.changeView=function(e,t){a.view=e,a.currentDay=t},a.control=a.control||{},a.control.prev=function(){a.currentDay=e(a.currentDay).subtract(1,a.view).toDate()},a.control.next=function(){a.currentDay=e(a.currentDay).add(1,a.view).toDate()},a.control.getTitle=function(){return t.titleFunctions[a.view]?t.titleFunctions[a.view](a.currentDay):""}}]}}]);
//# sourceMappingURL=angular-bootstrap-calendar-tpls.min.js.map